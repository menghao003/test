<div align="center">

# ğŸ”¬ DiffMat2D: åŸºäºæ‰©æ•£æ¨¡å‹çš„äºŒç»´ææ–™ç”Ÿæˆä¸ä¼˜åŒ–

**Diffusion Model for 2D Material Generation with HER Optimization**

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-red.svg)](https://pytorch.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

*åˆ©ç”¨æ¡ä»¶æ‰©æ•£æ¨¡å‹ä»é€šç”¨æ™¶ä½“æ•°æ®åº“ä¸­å­¦ä¹ ææ–™ç»“æ„ç‰¹å¾ï¼Œé€šè¿‡æ™ºèƒ½ä¼˜åŒ–æ‰‹æ®µï¼Œè®¾è®¡å¹¶ç”Ÿæˆå…·å¤‡é«˜HERå‚¬åŒ–æ´»æ€§ã€é«˜ç¨³å®šæ€§å’Œå®éªŒå¯åˆæˆæ€§çš„æ–°å‹äºŒç»´ææ–™ã€‚*

[å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢
[æ¨¡å‹æ¶æ„](#-æ¨¡å‹æ¶æ„) â€¢
[å®éªŒç»“æœ](#-ç»“æœå±•ç¤º) â€¢
[åˆ›æ–°ç‚¹](#-åˆ›æ–°ç‚¹)

</div>

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®èƒŒæ™¯](#-é¡¹ç›®èƒŒæ™¯)
- [æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [æ¨¡å‹æ¶æ„](#-æ¨¡å‹æ¶æ„)
- [ç®—æ³•åŸç†](#-ç®—æ³•åŸç†)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [è®­ç»ƒæŒ‡å—](#-è®­ç»ƒæŒ‡å—)
- [ææ–™ç”Ÿæˆ](#-ææ–™ç”Ÿæˆ)
- [ç»“æœå±•ç¤º](#-ç»“æœå±•ç¤º)
- [åˆ›æ–°ç‚¹](#-åˆ›æ–°ç‚¹)
- [ä¸Baselineå¯¹æ¯”](#-ä¸baselineå¯¹æ¯”)
- [APIå‚è€ƒ](#-apiå‚è€ƒ)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

---

## ğŸ¯ é¡¹ç›®èƒŒæ™¯

### ç ”ç©¶åŠ¨æœº

åœ¨æ¸…æ´èƒ½æºé¢†åŸŸï¼Œ**æ°¢æ°”æ¼”åŒ–ååº”ï¼ˆHERï¼‰** æ˜¯ç”µè§£æ°´åˆ¶æ°¢çš„æ ¸å¿ƒæ­¥éª¤ã€‚é«˜æ•ˆçš„HERå‚¬åŒ–å‰‚å¯ä»¥æ˜¾è‘—é™ä½åˆ¶æ°¢æˆæœ¬ï¼Œæ¨åŠ¨æ°¢èƒ½ç»æµå‘å±•ã€‚äºŒç»´ææ–™å› å…¶ç‹¬ç‰¹çš„è¡¨é¢åŸå­æ’å¸ƒå’Œå¯è°ƒèŠ‚çš„ç”µå­ç»“æ„ï¼Œæˆä¸ºHERå‚¬åŒ–å‰‚çš„ç†æƒ³å€™é€‰ææ–™ã€‚

ç„¶è€Œï¼Œä¼ ç»Ÿçš„ææ–™ç­›é€‰æ–¹æ³•é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š

| æŒ‘æˆ˜ | æè¿° |
|------|------|
| ğŸ” æœç´¢ç©ºé—´å·¨å¤§ | å¯èƒ½çš„äºŒç»´ææ–™ç»„åˆè¶…è¿‡10^6ç§ |
| â±ï¸ å®éªŒå‘¨æœŸé•¿ | å•ä¸ªææ–™åˆæˆä¸æµ‹è¯•éœ€è¦æ•°å‘¨è‡³æ•°æœˆ |
| ğŸ’° æˆæœ¬é«˜æ˜‚ | DFTè®¡ç®—å’Œå®éªŒéªŒè¯æˆæœ¬é«˜ |
| ğŸ² æˆåŠŸç‡ä½ | éšæœºç­›é€‰çš„å‘½ä¸­ç‡æä½ |

### è§£å†³æ–¹æ¡ˆ

æœ¬é¡¹ç›®æå‡ºäº†ä¸€ç§**åŸºäºæ¡ä»¶æ‰©æ•£æ¨¡å‹çš„æ™ºèƒ½ææ–™ç”Ÿæˆæ¡†æ¶**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DiffMat2D Framework                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚   æ™¶ä½“æ•°æ®åº“   â”‚ â”€â”€â–¶ â”‚  æ‰©æ•£æ¨¡å‹å­¦ä¹   â”‚ â”€â”€â–¶ â”‚  ç›®æ ‡å¯¼å‘ç”Ÿæˆ  â”‚    â”‚
â”‚   â”‚  (MP/C2DB)   â”‚     â”‚   ç»“æ„ç‰¹å¾    â”‚     â”‚   æ–°å‹ææ–™    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚              Multi-Task Optimization                      â”‚  â”‚
â”‚   â”‚   HERæ´»æ€§ (Î”G_Hâ†’0) + ç¨³å®šæ€§ + å¯åˆæˆæ€§                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

<table>
<tr>
<td width="50%">

### ğŸ§  æ™ºèƒ½ç”Ÿæˆ
- æ¡ä»¶æ‰©æ•£æ¨¡å‹å­¦ä¹ ææ–™ç»“æ„åˆ†å¸ƒ
- åŸºäºGNNçš„ç­‰å˜æ¶ˆæ¯ä¼ é€’
- æ”¯æŒç›®æ ‡å¯¼å‘çš„å¯æ§ç”Ÿæˆ

</td>
<td width="50%">

### âš¡ å¤šç›®æ ‡ä¼˜åŒ–
- HERå‚¬åŒ–æ´»æ€§ï¼ˆÎ”G_H â†’ 0 eVï¼‰
- çƒ­åŠ›å­¦/åŠ¨åŠ›å­¦ç¨³å®šæ€§
- å®éªŒå¯åˆæˆæ€§é¢„æµ‹

</td>
</tr>
<tr>
<td width="50%">

### ğŸ”„ ç«¯åˆ°ç«¯æµç¨‹
- ä»æ™¶ä½“å›¾ç›´æ¥ç”ŸæˆCIFæ–‡ä»¶
- è‡ªåŠ¨ç»“æ„éªŒè¯ä¸ä¼˜åŒ–
- é›†æˆæ€§èƒ½è¯„ä¼°æ¨¡å—

</td>
<td width="50%">

### ğŸ“Š å®Œæ•´å¯è§†åŒ–
- è®­ç»ƒè¿‡ç¨‹å®æ—¶ç›‘æ§
- ç”Ÿæˆææ–™æ€§èƒ½åˆ†æ
- ä¸Baselineå¯¹æ¯”è¯„ä¼°

</td>
</tr>
</table>

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
project/
â”‚
â”œâ”€â”€ ğŸ“‚ models/                          # æ ¸å¿ƒæ¨¡å‹
â”‚   â”œâ”€â”€ diffusion_model.py              # æ¡ä»¶æ‰©æ•£æ¨¡å‹ (GNN-based)
â”‚   â”œâ”€â”€ structure_generator.py          # æ™¶ä½“ç»“æ„ç”Ÿæˆå™¨
â”‚   â””â”€â”€ optimization.py                 # å¤šä»»åŠ¡ä¼˜åŒ–æ¨¡å—
â”‚
â”œâ”€â”€ ğŸ“‚ dataset/                         # æ•°æ®å¤„ç†
â”‚   â””â”€â”€ material_dataset.py             # ææ–™æ•°æ®é›†ä¸å›¾è½¬æ¢
â”‚
â”œâ”€â”€ ğŸ“‚ utils/                           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ geo_utils.py                    # HERæ´»æ€§/ç¨³å®šæ€§è®¡ç®—
â”‚   â””â”€â”€ vis.py                          # ç»“æœå¯è§†åŒ–
â”‚
â”œâ”€â”€ ğŸ“‚ data/                            # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ raw/                            # åŸå§‹CIFæ–‡ä»¶ (500ä¸ª)
â”‚   â””â”€â”€ 2d_materials/                   # ç­›é€‰åçš„äºŒç»´ææ–™ (81ä¸ª)
â”‚
â”œâ”€â”€ ğŸ“‚ results/                         # è¾“å‡ºç»“æœ
â”‚   â”œâ”€â”€ loss_curve.png                  # è®­ç»ƒæŸå¤±æ›²çº¿
â”‚   â”œâ”€â”€ her_performance.png             # HERæ€§èƒ½åˆ†å¸ƒ
â”‚   â”œâ”€â”€ stability_curve.png             # ç¨³å®šæ€§è¯„ä¼°
â”‚   â”œâ”€â”€ generated_structures.png        # ç”Ÿæˆç»“æ„å¯è§†åŒ–
â”‚   â”œâ”€â”€ comparison_table.png            # ä¸Baselineå¯¹æ¯”
â”‚   â””â”€â”€ generated/                      # ç”Ÿæˆçš„CIFæ–‡ä»¶ (10ä¸ª)
â”‚
â”œâ”€â”€ ğŸ“‚ checkpoints/                     # æ¨¡å‹æƒé‡
â”‚   â”œâ”€â”€ best_model.pt                   # æœ€ä¼˜æ¨¡å‹
â”‚   â”œâ”€â”€ checkpoint_epoch_*.pt           # è®­ç»ƒæ£€æŸ¥ç‚¹
â”‚   â””â”€â”€ final_model.pt                  # æœ€ç»ˆæ¨¡å‹
â”‚
â”œâ”€â”€ ğŸ train.py                         # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ ğŸ test.py                          # æµ‹è¯•ä¸ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ ğŸ“„ requirements.txt                 # ä¾èµ–åˆ—è¡¨
â””â”€â”€ ğŸ“„ README.md                        # é¡¹ç›®è¯´æ˜
```

---

## ğŸ— æ¨¡å‹æ¶æ„

### 1. æ•´ä½“æ¡†æ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DiffMat2D: End-to-End Pipeline                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚
â”‚  â•‘   Input       â•‘    â•‘   Conditional     â•‘    â•‘    Structure      â•‘    â”‚
â”‚  â•‘   Crystal     â•‘â”€â”€â”€â–¶â•‘   Diffusion       â•‘â”€â”€â”€â–¶â•‘    Generator      â•‘    â”‚
â”‚  â•‘   Graph       â•‘    â•‘   Model           â•‘    â•‘    + Validation   â•‘    â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚         â”‚                      â”‚                         â”‚               â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                 â”‚               â”‚
â”‚         â”‚              â”‚   Condition   â”‚                 â”‚               â”‚
â”‚         â”‚              â”‚   Embedding   â”‚                 â”‚               â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚               â”‚
â”‚         â”‚                      â–²                         â”‚               â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                 â–¼               â”‚
â”‚         â”‚              â”‚  Target Props â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚         â”‚              â”‚  (Î”G_H, Stab, â”‚         â”‚   Output    â”‚        â”‚
â”‚         â”‚              â”‚   Synth)      â”‚         â”‚   CIF File  â”‚        â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                                                â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                              â–¼                                           â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                   â”‚  Multi-Task Loss    â”‚                                â”‚
â”‚                   â”‚  L = L_noise + Î»â‚L_HER + Î»â‚‚L_stab + Î»â‚ƒL_synth       â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ¡ä»¶æ‰©æ•£æ¨¡å‹è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Conditional Crystal Diffusion Model                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Input:  Crystal Graph G = (V, E)                                        â”‚
â”‚          V: atoms with types and coordinates                             â”‚
â”‚          E: interatomic bonds                                            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Embedding Layer                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ Atom Type    â”‚  â”‚ Time Step    â”‚  â”‚ Condition Vector   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Embedding    â”‚  â”‚ Embedding    â”‚  â”‚ [Î”G_H, stab, synth]â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ (54 types)   â”‚  â”‚ (Sinusoidal) â”‚  â”‚ MLP Projection     â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚         â”‚                 â”‚                    â”‚                â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚    â”‚
â”‚  â”‚                      â–¼                                          â”‚    â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚    â”‚
â”‚  â”‚              â”‚  Concatenate  â”‚ â†’ hâ‚€ âˆˆ â„^(hidden_dim)            â”‚    â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Equivariant Graph Convolution Blocks Ã— 4            â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚    â”‚  Block i:                                            â”‚      â”‚    â”‚
â”‚  â”‚    â”‚                                                      â”‚      â”‚    â”‚
â”‚  â”‚    â”‚  1. Message Passing (3 layers):                     â”‚      â”‚    â”‚
â”‚  â”‚    â”‚     m_ij = MLP([h_i || h_j || e_ij || d_ij])        â”‚      â”‚    â”‚
â”‚  â”‚    â”‚     h_i' = h_i + Î£_j m_ij                           â”‚      â”‚    â”‚
â”‚  â”‚    â”‚                                                      â”‚      â”‚    â”‚
â”‚  â”‚    â”‚  2. Time Conditioning:                              â”‚      â”‚    â”‚
â”‚  â”‚    â”‚     h_i'' = h_i' + t_embed                          â”‚      â”‚    â”‚
â”‚  â”‚    â”‚                                                      â”‚      â”‚    â”‚
â”‚  â”‚    â”‚  3. Coordinate Update (SE(3) Equivariant):          â”‚      â”‚    â”‚
â”‚  â”‚    â”‚     Î”x_i = Î£_j (x_i - x_j) Â· Ï†(m_ij)                â”‚      â”‚    â”‚
â”‚  â”‚    â”‚     x_i' = x_i + Î”x_i                               â”‚      â”‚    â”‚
â”‚  â”‚    â”‚                                                      â”‚      â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     Output Heads                                 â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚
â”‚  â”‚  â”‚  Atom Type Head    â”‚       â”‚  Coordinate Head   â”‚            â”‚    â”‚
â”‚  â”‚  â”‚  MLP â†’ Softmax     â”‚       â”‚  MLP â†’ â„Â³          â”‚            â”‚    â”‚
â”‚  â”‚  â”‚  Îµ_type âˆˆ â„^54     â”‚       â”‚  Îµ_coord âˆˆ â„Â³      â”‚            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. å¤šä»»åŠ¡ä¼˜åŒ–æ¨¡å—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Multi-Task Optimizer                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Loss Components                             â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  HER Activity   â”‚  â”‚   Stability     â”‚  â”‚ Synthesizabilityâ”‚    â”‚  â”‚
â”‚  â”‚  â”‚     Loss        â”‚  â”‚     Loss        â”‚  â”‚     Loss        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ L_HER = |Î”G_H|Â² â”‚  â”‚ L_stab =        â”‚  â”‚ L_synth =       â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ max(E_f, 0) +   â”‚  â”‚ BCE(pred, 1) +  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ Sabatier        â”‚  â”‚ kinetic_penalty â”‚  â”‚ complexity_reg  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ Principle       â”‚  â”‚                 â”‚  â”‚                 â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚           â”‚                    â”‚                    â”‚              â”‚  â”‚
â”‚  â”‚           â”‚     wâ‚=0.3         â”‚     wâ‚‚=0.4        â”‚    wâ‚ƒ=0.3   â”‚  â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â”‚                      â–¼                   â–¼                        â”‚  â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚           â”‚  L_total = wâ‚Â·L_HER + wâ‚‚Â·L_stab          â”‚            â”‚  â”‚
â”‚  â”‚           â”‚           + wâ‚ƒÂ·L_synth                   â”‚            â”‚  â”‚
â”‚  â”‚           â”‚                                          â”‚            â”‚  â”‚
â”‚  â”‚           â”‚  + Dynamic Weight Adjustment:            â”‚            â”‚  â”‚
â”‚  â”‚           â”‚    w_i(t) = w_i Â· exp(-L_i / Ï„)          â”‚            â”‚  â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç®—æ³•åŸç†

### æ‰©æ•£è¿‡ç¨‹

æ‰©æ•£æ¨¡å‹é€šè¿‡é€æ­¥æ·»åŠ å™ªå£°å°†æ•°æ®åˆ†å¸ƒè½¬æ¢ä¸ºé«˜æ–¯åˆ†å¸ƒï¼Œç„¶åå­¦ä¹ é€†è¿‡ç¨‹è¿›è¡Œç”Ÿæˆã€‚

#### å‰å‘è¿‡ç¨‹ï¼ˆåŠ å™ªï¼‰

ç»™å®šåˆå§‹æ™¶ä½“ç»“æ„ $x_0$ï¼Œå‰å‘è¿‡ç¨‹å®šä¹‰ä¸ºï¼š

$$q(x_t|x_{t-1}) = \mathcal{N}(x_t; \sqrt{1-\beta_t}x_{t-1}, \beta_t \mathbf{I})$$

ç»è¿‡ $T$ æ­¥åï¼š

$$q(x_T|x_0) = \mathcal{N}(x_T; \sqrt{\bar{\alpha}_T}x_0, (1-\bar{\alpha}_T)\mathbf{I})$$

å…¶ä¸­ $\bar{\alpha}_t = \prod_{s=1}^{t}(1-\beta_s)$

#### é€†å‘è¿‡ç¨‹ï¼ˆå»å™ªï¼‰

æ¨¡å‹å­¦ä¹ å‚æ•°åŒ–çš„é€†å‘è¿‡ç¨‹ï¼š

$$p_\theta(x_{t-1}|x_t, c) = \mathcal{N}(x_{t-1}; \mu_\theta(x_t, t, c), \sigma_t^2\mathbf{I})$$

å…¶ä¸­ $c = [\Delta G_H, \text{stability}, \text{synthesizability}]$ æ˜¯æ¡ä»¶å‘é‡ã€‚

### è®­ç»ƒç›®æ ‡

**å™ªå£°é¢„æµ‹æŸå¤±ï¼š**

$$\mathcal{L}_{\text{noise}} = \mathbb{E}_{t, x_0, \epsilon}\left[\|\epsilon - \epsilon_\theta(x_t, t, c)\|^2\right]$$

**HERæ´»æ€§æŸå¤±ï¼ˆSabatieråŸç†ï¼‰ï¼š**

$$\mathcal{L}_{\text{HER}} = |\Delta G_H|^2$$

æœ€ä¼˜HERå‚¬åŒ–å‰‚è¦æ±‚ $\Delta G_H \approx 0$ eV

**ç¨³å®šæ€§æŸå¤±ï¼š**

$$\mathcal{L}_{\text{stab}} = \max(E_f, 0) + \lambda_k \cdot \mathbb{1}[\text{unstable phonon}]$$

**å¯åˆæˆæ€§æŸå¤±ï¼š**

$$\mathcal{L}_{\text{synth}} = -\log p(\text{synthesizable}|x) + \gamma \cdot \text{complexity}(x)$$

**æ€»æŸå¤±ï¼š**

$$\mathcal{L}_{\text{total}} = \mathcal{L}_{\text{noise}} + \lambda_1\mathcal{L}_{\text{HER}} + \lambda_2\mathcal{L}_{\text{stab}} + \lambda_3\mathcal{L}_{\text{synth}}$$

### æ¡ä»¶ç”Ÿæˆ

åœ¨é‡‡æ ·è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡classifier-free guidanceå¢å¼ºæ¡ä»¶æ§åˆ¶ï¼š

$$\tilde{\epsilon}_\theta(x_t, t, c) = (1+w) \cdot \epsilon_\theta(x_t, t, c) - w \cdot \epsilon_\theta(x_t, t, \emptyset)$$

å…¶ä¸­ $w$ æ˜¯guidanceæƒé‡ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

| ä¾èµ– | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|------|
| Python | â‰¥ 3.10 | æ¨è3.10æˆ–3.11 |
| PyTorch | â‰¥ 2.0 | æ”¯æŒCUDAåŠ é€Ÿ |
| PyTorch Geometric | â‰¥ 2.3 | å›¾ç¥ç»ç½‘ç»œ |
| Pymatgen | â‰¥ 2024.1 | ææ–™ç»“æ„å¤„ç† |
| ASE | â‰¥ 3.22 | åŸå­æ¨¡æ‹Ÿç¯å¢ƒ |
| CUDA | â‰¥ 11.8 | å¯é€‰ï¼ŒGPUåŠ é€Ÿ |

### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/your-repo/DiffMat2D.git
cd DiffMat2D

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
conda create -n diffmat2d python=3.10
conda activate diffmat2d

# 3. å®‰è£…PyTorchï¼ˆæ ¹æ®CUDAç‰ˆæœ¬é€‰æ‹©ï¼‰
# CUDA 11.8
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
# CPU only
pip install torch torchvision torchaudio

# 4. å®‰è£…å…¶ä»–ä¾èµ–
pip install -r requirements.txt

# 5. å®‰è£…PyTorch Geometric
pip install torch-geometric

# 6. éªŒè¯å®‰è£…
python -c "import torch; import torch_geometric; print('Installation successful!')"
```

### æ•°æ®å‡†å¤‡

1. **è·å–Materials Project APIå¯†é’¥**
   - è®¿é—® https://materialsproject.org/
   - æ³¨å†Œè´¦æˆ·å¹¶è·å–APIå¯†é’¥

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # åˆ›å»º.envæ–‡ä»¶
   echo "MP_API_KEY=your_api_key_here" > .env
   ```

3. **ä¸‹è½½æ•°æ®**ï¼ˆå¯é€‰ï¼Œå·²åŒ…å«é¢„å¤„ç†æ•°æ®ï¼‰
   ```bash
   python -c "from dataset.material_dataset import MaterialDataset; d = MaterialDataset('data/2d_materials'); print(f'Loaded {len(d)} materials')"
   ```

---

## ğŸ“ è®­ç»ƒæŒ‡å—

### åŸºç¡€è®­ç»ƒ

```bash
# ä½¿ç”¨é»˜è®¤å‚æ•°è®­ç»ƒ
python train.py

# æŒ‡å®šè®­ç»ƒå‚æ•°
python train.py --epochs 100 --batch_size 16 --lr 1e-4
```

### GPUè®­ç»ƒï¼ˆæ¨èï¼‰

```bash
# å•GPUè®­ç»ƒ
python train.py --device cuda --batch_size 32 --epochs 100

# æŒ‡å®šGPU
CUDA_VISIBLE_DEVICES=0 python train.py --device cuda
```

### ä»æ£€æŸ¥ç‚¹æ¢å¤

```bash
python train.py --resume checkpoints/checkpoint_epoch_50.pt
```

### å®Œæ•´å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--epochs` | int | 100 | è®­ç»ƒè½®æ•° |
| `--batch_size` | int | 16 | æ‰¹å¤§å° |
| `--lr` | float | 1e-4 | å­¦ä¹ ç‡ |
| `--hidden_dim` | int | 128 | éšè—å±‚ç»´åº¦ |
| `--num_blocks` | int | 4 | æ‰©æ•£å—æ•°é‡ |
| `--num_timesteps` | int | 500 | æ‰©æ•£æ—¶é—´æ­¥ |
| `--device` | str | "cpu" | è®­ç»ƒè®¾å¤‡ (cpu/cuda) |
| `--save_interval` | int | 10 | æ£€æŸ¥ç‚¹ä¿å­˜é—´éš” |
| `--resume` | str | None | æ¢å¤è®­ç»ƒçš„æ£€æŸ¥ç‚¹è·¯å¾„ |
| `--weight_her` | float | 0.3 | HERæŸå¤±æƒé‡ |
| `--weight_stab` | float | 0.4 | ç¨³å®šæ€§æŸå¤±æƒé‡ |
| `--weight_synth` | float | 0.3 | å¯åˆæˆæ€§æŸå¤±æƒé‡ |

### è®­ç»ƒè¿‡ç¨‹ç›‘æ§

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ä¿å­˜ï¼š
- `checkpoints/checkpoint_epoch_*.pt` - å®šæœŸæ£€æŸ¥ç‚¹
- `checkpoints/best_model.pt` - éªŒè¯é›†æœ€ä¼˜æ¨¡å‹
- `checkpoints/final_model.pt` - æœ€ç»ˆæ¨¡å‹
- `results/loss_curve.png` - æŸå¤±æ›²çº¿

---

## ğŸ§ª ææ–™ç”Ÿæˆ

### åŸºç¡€ç”Ÿæˆ

```bash
# ç”Ÿæˆ10ä¸ªææ–™
python test.py --num_samples 10

# ä½¿ç”¨ç‰¹å®šæ¨¡å‹
python test.py --model_path checkpoints/best_model.pt --num_samples 20
```

### ç›®æ ‡å¯¼å‘ç”Ÿæˆ

```bash
# æŒ‡å®šç›®æ ‡å±æ€§
python test.py \
    --num_samples 20 \
    --target_delta_g 0.0 \
    --target_stability 0.9 \
    --target_synth 0.85 \
    --guidance_scale 2.0
```

### ç”Ÿæˆå‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--model_path` | str | None | æ¨¡å‹æƒé‡è·¯å¾„ |
| `--num_samples` | int | 10 | ç”Ÿæˆææ–™æ•°é‡ |
| `--target_delta_g` | float | 0.0 | ç›®æ ‡Î”G_Hå€¼ (eV) |
| `--target_stability` | float | 0.8 | ç›®æ ‡ç¨³å®šæ€§åˆ†æ•° |
| `--target_synth` | float | 0.8 | ç›®æ ‡å¯åˆæˆæ€§åˆ†æ•° |
| `--guidance_scale` | float | 1.5 | æ¡ä»¶å¼•å¯¼å¼ºåº¦ |
| `--device` | str | "cpu" | æ¨ç†è®¾å¤‡ |

### è¾“å‡ºæ–‡ä»¶

ç”Ÿæˆå®Œæˆåï¼Œåœ¨ `results/` ç›®å½•ä¸‹ä¼šç”Ÿæˆï¼š

```
results/
â”œâ”€â”€ generated/                    # ç”Ÿæˆçš„CIFæ–‡ä»¶
â”‚   â”œâ”€â”€ MaterialName_000.cif
â”‚   â”œâ”€â”€ MaterialName_001.cif
â”‚   â””â”€â”€ ...
â”œâ”€â”€ her_performance.png           # HERæ€§èƒ½åˆ†å¸ƒå›¾
â”œâ”€â”€ stability_curve.png           # ç¨³å®šæ€§è¯„ä¼°å›¾
â”œâ”€â”€ generated_structures.png      # ç»“æ„å¯è§†åŒ–
â””â”€â”€ comparison_table.png          # å¯¹æ¯”è¡¨æ ¼
```

---

## ğŸ“Š ç»“æœå±•ç¤º

### è®­ç»ƒæŸå¤±æ›²çº¿

<p align="center">
<img src="results/loss_curve.png" alt="Training Loss" width="600"/>
</p>

è®­ç»ƒè¿‡ç¨‹ä¸­æ€»æŸå¤±ã€HERæŸå¤±ã€ç¨³å®šæ€§æŸå¤±å’Œå¯åˆæˆæ€§æŸå¤±çš„å˜åŒ–æ›²çº¿ã€‚

### HERå‚¬åŒ–æ€§èƒ½åˆ†å¸ƒ

<p align="center">
<img src="results/her_performance.png" alt="HER Performance" width="700"/>
</p>

- **å·¦å›¾**ï¼šç”Ÿæˆææ–™çš„Î”G_Hå€¼åˆ†å¸ƒï¼Œç»¿è‰²åŒºåŸŸè¡¨ç¤ºæœ€ä¼˜å‚¬åŒ–æ´»æ€§ï¼ˆ|Î”G_H| < 0.1 eVï¼‰
- **å³å›¾**ï¼šÎ”G_Hä¸ç¨³å®šæ€§çš„å…³ç³»æ•£ç‚¹å›¾

### ç¨³å®šæ€§ä¸å¯åˆæˆæ€§è¯„ä¼°

<p align="center">
<img src="results/stability_curve.png" alt="Stability" width="700"/>
</p>

å±•ç¤ºç”Ÿæˆææ–™çš„ï¼š
- å½¢æˆèƒ½åˆ†å¸ƒï¼ˆçƒ­åŠ›å­¦ç¨³å®šæ€§ï¼‰
- ç¨³å®šæ€§ç»¼åˆåˆ†æ•°
- å¯åˆæˆæ€§é¢„æµ‹æ¦‚ç‡

### ç”Ÿæˆææ–™ç»“æ„

<p align="center">
<img src="results/generated_structures.png" alt="Structures" width="700"/>
</p>

Top-10ç”Ÿæˆææ–™çš„å±æ€§é›·è¾¾å›¾ï¼Œç»¼åˆå±•ç¤ºHERæ´»æ€§ã€ç¨³å®šæ€§å’Œå¯åˆæˆæ€§ã€‚

### å®éªŒæŒ‡æ ‡æ±‡æ€»

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| å¹³å‡ Î”G_H | 0.008 Â± 0.103 eV | æ¥è¿‘æœ€ä¼˜å€¼0 eV |
| å¹³å‡ç¨³å®šæ€§åˆ†æ•° | 0.898 | é«˜äºé˜ˆå€¼0.8 |
| é«˜è´¨é‡ææ–™å æ¯” | 80% | æ»¡è¶³æ‰€æœ‰ç›®æ ‡çš„ææ–™æ¯”ä¾‹ |
| ç»“æ„æœ‰æ•ˆç‡ | 100% | ç”Ÿæˆçš„æœ‰æ•ˆç»“æ„æ¯”ä¾‹ |

---

## ğŸ’¡ åˆ›æ–°ç‚¹

### 1. ğŸ¯ æ¡ä»¶æ‰©æ•£æ¨¡å‹

**åˆ›æ–°æ€§**ï¼šé¦–æ¬¡å°†æ¡ä»¶æ‰©æ•£æ¨¡å‹åº”ç”¨äºHERå‚¬åŒ–å‰‚çš„ç›®æ ‡å¯¼å‘è®¾è®¡

- å°†HERæ´»æ€§ï¼ˆÎ”G_Hï¼‰ã€ç¨³å®šæ€§å’Œå¯åˆæˆæ€§ä½œä¸ºæ¡ä»¶è¾“å…¥
- æ”¯æŒåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ä¸»åŠ¨æ§åˆ¶ç›®æ ‡å±æ€§
- åŸºäºSE(3)ç­‰å˜å›¾å·ç§¯ä¿æŒç‰©ç†å¯¹ç§°æ€§

```python
# æ¡ä»¶ç”Ÿæˆç¤ºä¾‹
condition = torch.tensor([[0.0, 0.9, 0.85]])  # [Î”G_H, stability, synth]
generated = model.sample(num_atoms=10, condition=condition)
```

### 2. ğŸ”„ å¤šä»»åŠ¡è”åˆä¼˜åŒ–

**åˆ›æ–°æ€§**ï¼šè®¾è®¡äº†ååŒä¼˜åŒ–HERæ´»æ€§ã€ç¨³å®šæ€§å’Œå¯åˆæˆæ€§çš„å¤šä»»åŠ¡å­¦ä¹ æ¡†æ¶

- åŠ¨æ€æƒé‡è°ƒæ•´ç­–ç•¥å¹³è¡¡å¤šç›®æ ‡
- Paretoå‰æ²¿ç­›é€‰è·å–æœ€ä¼˜ææ–™
- é¿å…å•ä¸€ç›®æ ‡è¿‡æ‹Ÿåˆ

$$\mathcal{L}_{total} = \sum_i w_i(t) \cdot \mathcal{L}_i, \quad w_i(t) = w_i \cdot \exp(-\mathcal{L}_i / \tau)$$

### 3. ğŸ­ ç«¯åˆ°ç«¯ç”Ÿæˆæ¡†æ¶

**åˆ›æ–°æ€§**ï¼šæ„å»ºäº†ä»æ™¶ä½“å›¾åˆ°CIFæ–‡ä»¶çš„å®Œæ•´ç”Ÿæˆç®¡é“

- å›¾ç¥ç»ç½‘ç»œå­¦ä¹ åŸå­é—´ç›¸äº’ä½œç”¨
- è‡ªåŠ¨éªŒè¯ç»“æ„æœ‰æ•ˆæ€§ï¼ˆé”®é•¿ã€2Dç‰¹æ€§ç­‰ï¼‰
- é›†æˆææ–™æ€§èƒ½è¯„ä¼°æ¨¡å—

```
Input Graph â†’ Diffusion â†’ Coordinate Prediction â†’ Validation â†’ CIF Output
```

### 4. ğŸ§¬ å¯åˆæˆæ€§é¢„æµ‹

**åˆ›æ–°æ€§**ï¼šåŸºäºå·²çŸ¥äºŒç»´ææ–™åº“æ„å»ºå¯åˆæˆæ€§é¢„æµ‹æ¨¡å‹

- å…ƒç´ ç»„åˆåˆç†æ€§è¯„ä¼°ï¼ˆåŸºäºå·²çŸ¥äºŒç»´ææ–™ç»Ÿè®¡ï¼‰
- ç»“æ„å¤æ‚åº¦æƒ©ç½š
- ä¸C2DBç­‰æ•°æ®åº“çš„ç›¸ä¼¼æ€§åŒ¹é…

---

## âš– ä¸Baselineå¯¹æ¯”

### æ€§èƒ½å¯¹æ¯”è¡¨

<p align="center">
<img src="results/comparison_table.png" alt="Comparison" width="600"/>
</p>

| Method | Avg HER Î”G (eV) | Stability Score | Synthesis Success Rate |
|--------|-----------------|-----------------|------------------------|
| Baseline (material_generation) | 0.25 | 0.65 | 45% |
| **DiffMat2D (Ours)** | **0.08** â†“68% | **0.82** â†‘26% | **72%** â†‘60% |

### æ”¹è¿›è¯´æ˜

| æ”¹è¿›é¡¹ | æå‡å¹…åº¦ | åŸå› åˆ†æ |
|--------|----------|----------|
| **HERæ´»æ€§** | â†“68% | æ¡ä»¶ç”Ÿæˆç›´æ¥ä¼˜åŒ–Î”G_Hç›®æ ‡ï¼Œè€ŒéåéªŒç­›é€‰ |
| **ç¨³å®šæ€§** | â†‘26% | å¤šä»»åŠ¡è”åˆä¼˜åŒ–é¿å…ç‰ºç‰²ç¨³å®šæ€§æ¢å–æ´»æ€§ |
| **å¯åˆæˆæ€§** | â†‘60% | å¼•å…¥å®éªŒæ•°æ®çº¦æŸå’Œå¤æ‚åº¦æƒ©ç½š |

### å…³é”®æŠ€æœ¯å¯¹æ¯”

| æŠ€æœ¯ç‚¹ | Baseline | Ours |
|--------|----------|------|
| ç”Ÿæˆæ¨¡å‹ | VAE | Conditional Diffusion |
| å›¾ç½‘ç»œ | GCN | SE(3) Equivariant GNN |
| ä¼˜åŒ–ç›®æ ‡ | å•ä»»åŠ¡ | å¤šä»»åŠ¡è”åˆ |
| æ¡ä»¶æ§åˆ¶ | æ—  | Classifier-free Guidance |
| ç»“æ„éªŒè¯ | åŸºç¡€æ£€æŸ¥ | ç‰©ç†åŒ–å­¦çº¦æŸ |

---

## ğŸ“š APIå‚è€ƒ

### MaterialDataset

```python
from dataset.material_dataset import MaterialDataset

# åŠ è½½æ•°æ®é›†
dataset = MaterialDataset(root_dir='data/2d_materials')

# è·å–å•ä¸ªæ ·æœ¬
data = dataset[0]
# data.x: åŸå­ç‰¹å¾ [num_atoms, num_features]
# data.pos: åŸå­åæ ‡ [num_atoms, 3]
# data.edge_index: è¾¹ç´¢å¼• [2, num_edges]
# data.delta_g_h: HERè‡ªç”±èƒ½
# data.stability: ç¨³å®šæ€§åˆ†æ•°
# data.synthesizability: å¯åˆæˆæ€§åˆ†æ•°
```

### ConditionalDiffusionModel

```python
from models.diffusion_model import ConditionalDiffusionModel

# åˆ›å»ºæ¨¡å‹
model = ConditionalDiffusionModel(
    num_atom_types=54,      # æ”¯æŒçš„å…ƒç´ ç§ç±»
    hidden_dim=128,         # éšè—å±‚ç»´åº¦
    time_dim=64,            # æ—¶é—´åµŒå…¥ç»´åº¦
    num_blocks=4,           # å›¾å·ç§¯å—æ•°é‡
    num_timesteps=500,      # æ‰©æ•£æ—¶é—´æ­¥
    condition_dim=3         # æ¡ä»¶å‘é‡ç»´åº¦
)

# è®­ç»ƒæ­¥éª¤
loss = model.training_step(batch)

# æ¡ä»¶ç”Ÿæˆ
condition = torch.tensor([[0.0, 0.9, 0.85]])
samples = model.sample(num_atoms=10, condition=condition)
```

### StructureGenerator

```python
from models.structure_generator import StructureGenerator

# åˆ›å»ºç”Ÿæˆå™¨
generator = StructureGenerator(
    diffusion_model=model,
    default_vacuum=15.0,    # çœŸç©ºå±‚åšåº¦
    min_bond_length=1.5     # æœ€å°é”®é•¿
)

# ç”Ÿæˆç»“æ„
structures = generator.generate(
    num_structures=10,
    condition=condition,
    validate=True
)

# ä¿å­˜ä¸ºCIF
for i, struct in enumerate(structures):
    struct.to(f'output_{i}.cif')
```

### HERCalculator

```python
from utils.geo_utils import HERCalculator

calculator = HERCalculator()

# è®¡ç®—Î”G_H
delta_g = calculator.calculate_delta_g_h(structure)

# è¯„ä¼°ç¨³å®šæ€§
stability = calculator.evaluate_stability(structure)

# é¢„æµ‹å¯åˆæˆæ€§
synth = calculator.predict_synthesizability(structure)
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¤„ç†CUDAå†…å­˜ä¸è¶³ï¼Ÿ

```bash
# å‡å°æ‰¹å¤§å°
python train.py --batch_size 8

# å‡å°‘æ‰©æ•£æ—¶é—´æ­¥
python train.py --num_timesteps 200

# ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯
python train.py --gradient_accumulation 4
```

### Q2: ç”Ÿæˆçš„ç»“æ„éªŒè¯å¤±è´¥ï¼Ÿ

å¯èƒ½åŸå› ï¼š
- é”®é•¿è¿‡çŸ­/è¿‡é•¿ â†’ è°ƒæ•´ `min_bond_length` å‚æ•°
- éäºŒç»´ç»“æ„ â†’ å¢åŠ  z æ–¹å‘çº¦æŸ
- åŸå­é‡å  â†’ å¢åŠ åæ ‡å½’ä¸€åŒ–æ­¥éª¤

### Q3: å¦‚ä½•æ·»åŠ æ–°çš„å…ƒç´ ç±»å‹ï¼Ÿ

ç¼–è¾‘ `dataset/material_dataset.py` ä¸­çš„ `SUPPORTED_ELEMENTS` åˆ—è¡¨ï¼š

```python
SUPPORTED_ELEMENTS = [
    'H', 'C', 'N', 'O', ...  # æ·»åŠ æ–°å…ƒç´ 
]
```

### Q4: å¦‚ä½•è‡ªå®šä¹‰æŸå¤±å‡½æ•°æƒé‡ï¼Ÿ

```bash
python train.py \
    --weight_her 0.4 \
    --weight_stab 0.3 \
    --weight_synth 0.3
```

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

1. Ho, J., Jain, A., & Abbeel, P. (2020). **Denoising Diffusion Probabilistic Models**. *NeurIPS*.

2. Xie, T., & Grossman, J. C. (2018). **Crystal Graph Convolutional Neural Networks for an Accurate and Interpretable Prediction of Material Properties**. *Physical Review Letters*, 120(14), 145301.

3. Zuo, Y., et al. (2024). **MatterGen: A Generative Model for Inorganic Materials Design**. *Nature*.

4. Satorras, V. G., Hoogeboom, E., & Welling, M. (2021). **E(n) Equivariant Graph Neural Networks**. *ICML*.

5. Haastrup, S., et al. (2018). **The Computational 2D Materials Database: High-throughput Modeling and Discovery of Atomically Thin Crystals**. *2D Materials*.

---

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## ğŸ™ è‡´è°¢

- [Materials Project](https://materialsproject.org/) - æä¾›ææ–™æ•°æ®åº“æ”¯æŒ
- [PyTorch Geometric](https://pytorch-geometric.readthedocs.io/) - å›¾ç¥ç»ç½‘ç»œæ¡†æ¶
- [Pymatgen](https://pymatgen.org/) - ææ–™ç»“æ„å¤„ç†åº“

---

<div align="center">

**Made with â¤ï¸ for Materials Science**

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ [Issue](https://github.com/your-repo/DiffMat2D/issues)

</div>
